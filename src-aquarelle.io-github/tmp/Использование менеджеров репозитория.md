# [Использование менеджеров репозитория](https://dzone.com/refcardz/binary-repository-management)

Лучший способ организации, хранения и распространения программных компонентов.

Предназначен для создания и настройки бинарного репозитория, оптимизации его для различных рабочих процессов и плавного перехода на жизненный цикл разработки программного обеспечения.



СЕКЦИЯ 1

## Введение

Разработка программного обеспечения зависит от двух различных видов компонентов: (1) исходного кода и (2) двоичных компонентов. Эта Refcard предполагает базовое знакомство с управлением исходным кодом и предназначена для разработки и настройки диспетчера хранилища для хранения, управления и совместного использования двоичных файлов, оптимизации его для различных рабочих процессов и плавного перехода на ваш конвейер DevOps.

Менеджеры хранилищ обычно доступны как бесплатные OSS и платные профессиональные версии. Большинство организаций захотят внедрить платную профессиональную версию по мере ее роста и усовершенствовать свои методы DevOps.

| ОСНОВНЫЕ ОСОБЕННОСТИ (БЕСПЛАТНО)         | ОСОБЕННОСТИ ПРОГРАММЫ (PAID) |
| ---------------------------------------- | ---------------------------- |
| Общественные репозитории прокси          | Поддержка предприятия        |
| Принимать локальные двоичные файлы или компоненты | Высокая доступность          |
| Групповые репозитории для прав доступа и безопасности | Интеллектуальные компоненты  |

РАЗДЕЛ 2

## Введение: Требования к хранилищу

Бинарный компонент - это результат любого шага в процессе разработки. Многие компоненты возникают из-за сборок, но важны и другие типы. Общие типы компонентов включают:

- Файлы ZIP или tarball
- RPM или пакеты DEB (Linux)
- JAR, WAR и EAR (Java)
- Npm (JavaScript)
- Пакеты NuGet (.NET)
- RubyGems (Ruby)
- Пакеты PyPI (Python)
- Изображения докеров
- DLL (Windows)
- Исходные пакеты
- Пакеты документации

### Два типа пакетов  

Различные типы, перечисленные выше, группируются в две группы: (1) источник и (2) двоичный компонент. И хотя можно использовать исходный репозиторий для хранения компонентов, некоторые существенные различия между этими двумя супертипами делают это решение не идеальным.

### Почему исходные репозитории?

Исходные репозитории предназначены для управления исходным кодом. Поэтому хорошо построенный репозиторий источников имеет набор функций, предназначенных для управления исходным кодом (например: разные версии, отслеживание удаленных или перезаписанных файлов, ветвление и тегирование).

### Почему (двоичные) менеджеры хранилищ?

Менеджеры хранилищ - это двоичные файлы, в которые исходные репозитории или VCS (Системы контроля версий) относятся к источникам. Если исходные репозитории имеют дело с относительно небольшими кодовыми файлами, которые постоянно изменяются и часто клонируются с отказом, двоичные репозитории управляют совершенно другим рабочим процессом. Менеджеры хранилищ предоставляют один источник правды для двоичных файлов, используемых в процессах водопада, гибких процессов и CI / CD. 
Бинарные компоненты часто на порядок больше исходных файлов. 
С точки зрения разработчика (хотя и не дизайнера) бинарные пакеты не нужно различать. 
За исключением редких ситуаций (например, снимки и ночные сборки), двоичные компоненты не удаляются и не перезаписываются. 
Двоичные компоненты обычно должны хранить множество метаданных (имя пакета, версия, лицензия и т. Д.).

### Когда использовать диспетчер репозитория

Для начала давайте поясним, что диспетчер репозитория отличается от репозитория. Менеджер репозитория отвечает за управление несколькими репозиториями, которые он размещает, каждый из которых имеет набор определенных функций и разрешений. Конструкция вашего диспетчера хранилища поможет определить роль, которую каждый репозиторий служит для разработки, проверки качества и операций, а также для команд, которые к ним обращаются.

Выбор того, как наилучшим образом взаимодействовать с зависимостями, как в исходной, так и в двоичной форме, обычно основывается на том, какую систему сборки вы используете. Фактически, возможность повторного использования бинарных зависимостей без их перекомпиляции обычно является ключевым критерием при выборе инструмента построения в первую очередь.

### Общие инструменты построения платформы

| ПЛАТФОРМА | СТРОИТЕЛЬНЫЙ ИНСТРУМЕНТ W / REPOS   |
| --------- | ----------------------------------- |
| JVM       | Maven, Ivy, Maven Ant Tasks, Gradle |
| .СЕТЬ     | NuGet                               |
| OSGi      | P2                                  |
| Yum       | Linux                               |
| докер     | докер                               |

В то время как у каждого другого инструмента построения или формата компонента может быть свой собственный встроенный репозиторий или репозиторий, почти все организации являются гетерогенными с точки зрения языков / инструментов сборки и форматов компонентов. В наши дни нередко можно найти несколько инструментов, даже в рамках одного приложения. Возьмем, к примеру, Java-приложение, построенное с помощью Maven, с пользовательским интерфейсом JavaScript с зависимостями, полученными из репозитория npm, в конечном итоге распределенным для тестирования и производства в качестве контейнера Docker. Это три инструмента, форматов и репозиториев в одном приложении. Вы хотите управлять тремя отдельными серверами с их собственными особенностями, требующими резервного копирования, разрешений и т. Д.?

Диспетчер репозитория - это концентратор для групп разработчиков по всей организации, централизующий управление всеми компонентами, созданными и используемыми организацией. Неизбежное результирующее разнообразие типов компонентов и их разные позиции в общем рабочем процессе - одна из основных причин использования специализированного диспетчера хранилища, а не просто простого файлового сервера.

Таким образом, решение использовать диспетчер репозитория обычно связано с тем, сколько репозиториев вам нужно, какие типы форматов данных продиктованы этими репозиториями и инструментами сборки, а также то, что вам нужно более высокого уровня над минимальным репозиторием. Общие факторы, которые следует учитывать, обсуждаются ниже.

РАЗДЕЛ 3

## Фактор 1: стороннее двоичное управление

### Проксирование бинарников

В какой-то момент в большинстве проектов вы будете использовать сторонние компоненты, размещенные в репозитории, внешнем по отношению к вашей организации. Задержка сети и пропускная способность напрямую скажутся на скорости разработки, особенно когда ваши внешние компоненты (в некоторых случаях, гигантские), даже если ваша команда полностью находится в помещении.

Теперь представьте, что вам нужно работать каждый день с последней версией нескольких зависимостей, и каждый из них занимает несколько минут, чтобы скачать - возможно, несколько раз в день. Теперь рассмотрим длинную цепочку зависимостей, и вы сразу же (и без каких-либо выигрышей на стороне разработки) в аддроме загрузки загрузки компонента.

Кроме того, внешние зависимости вводят элемент ненужного риска просто потому, что вы не можете контролировать доступ к ним. Чтобы устранить этот риск, настройте диспетчер хранилища для прокси-сервера этих файлов. Храните копию в своем приватном репозитории; То доступность зависимостей будет зависеть от вас. Вы также можете применять свои собственные политики резервного копирования и доступности, гарантируя доступ к компонентам, даже если восходящий репозиторий опускается, или они исчезают в восходящем репозитории. Для тех из вас, кто помнит «npm gate» в 2016 году, это стало реальной проблемой для тысяч команд разработчиков.

По своей самой основной сути, диспетчер репозитория является кэширующим прокси этих удаленных репозиториев. Кэшированные компоненты могут быть быстро отправлены на другие компьютеры в той же сети после первоначального запроса - либо на человеческие кодеры, либо непосредственно на серверы непрерывной интеграции (CI). Возможность кэшировать то, что вам нужно, локально изолирует вас от неизбежной латентности сети, проблем с подключением к Интернету или компонентов, случайно исчезающих из неправильно управляемого удаленного хранилища ala "npm gate".

### Расширенное управление сторонними компонентами

Некоторые организации могут иметь политику относительно того, какие зависимости от сторонних организаций могут использоваться из-за проблем с лицензированием или безопасностью.

Вот общий пример: сторонние компоненты должны запрашиваться разработчиком и утверждаться юридическим отделом. Часто мы видим попытки управлять этим процессом простым подходом белого списка / черного списка. Это неизбежно по нескольким причинам:

- Объем и объем сторонних компонентов колеблются. Типичное предприятие может легко потреблять многие сотни тысяч компонентов, каждый из которых выпускает новые версии четыре раза в год в среднем. Обследование людей каждой из них просто невозможно.
- Задержки в обзорах пользователей в списке заставляют разработчиков сделать одну из двух вещей: 1) прекратить обновление зависимостей, потому что трение слишком велико, что приводит к увеличению подверженности уязвимостям с течением времени и затрудняет его обновление позднее или 2) обойти Чтобы выполнить свою работу, что привело к уменьшению видимости того, что на самом деле используется, и в конечном итоге победить всю цель процесса.

К счастью, есть способы справиться с этим, у которых нет непреднамеренных побочных эффектов.

### Компонентный интеллект

Некоторые профессиональные версии Менеджеров хранилищ включают проверки работоспособности, чтобы обеспечить мгновенное понимание потенциальных рисков безопасности компонентов, лицензий и качества, чтобы команды разработчиков могли быстро и быстро принять корректирующие меры. Этот интеллект может помочь организациям идентифицировать известные проблемы безопасности, лицензии и архитектуры для каждого компонента. Возможности проверки работоспособности могут использоваться в качестве автоматизированного инструмента аудита для менеджеров по строительству, архитекторов, управления с открытым исходным кодом, безопасности и юристов.

![Название изображения](https://dzone.com/storage/temp/4902417-picture1.png)

### Брандмауэр компонента

Основываясь на анализе компонентов, некоторые менеджеры хранилищ могут предоставить форму брандмауэра. Становится возможным автоматизировать решения о том, какие компоненты можно включить в организацию, используя интеллект и объединив его с движком правил.

Это позволяет останавливать плохие компоненты (например, те, у которых уже есть известные уязвимости или те, у которых лицензии несовместимы с вашей бизнес-моделью) от проксирования и интеграции только для последующего изъятия. Эта модель является единственной, которая может масштабироваться, не требуя армии рецензентов.

Кроме того, компоненты, которые, как известно, хороши, когда они впервые используются, становятся плохими позже, когда обнаруживаются новые уязвимости. В процессе ручного просмотра практически ни одна организация не может идти в ногу с новыми запросами, и поэтому никто не возвращается, чтобы проверить вещи, которые были ранее запрошены и одобрены.

Механизм автоматических правил и постоянно обновляемый компонентный интеллект могут предупредить вас, когда эти компоненты ухудшаются, так что ваши разработчики могут немедленно сортировать и устранять проблему.

РАЗДЕЛ 4

## Фактор 2: Внутренние компоненты

В дополнение к потреблению сторонних компонентов, большинству современных инструментов построения также требуется место для подталкивания артефактов сборки к репозиторию. Это делается потому, что сами внутренние артефакты часто являются субсборками или другими зависимостями еще одной сборки. Это делает хостинг внутренне разработанных компонентов одинаково важной функцией диспетчера репозитория.

При структурировании внутренних размещенных репозиториев необходимо учитывать несколько факторов. Вы захотите разбить вещи на разные репозитории. Для этого вам необходимо сбалансировать удобство администрирования, не имея слишком много репозиториев против таких проблем, как безопасность (позже рассматривается), а также разбиение по частям.

Типичный пример использования для хранения временных компонентов. В Maven они формализованы как «снимки» и должны быть отделены от «выпусков». В других инструментах разделение не запекается. Администрирование и очистка будут проще, если вы сохраните компоненты, которые постоянно раздувают недолговечные версии, отличные от тех, которые вы намерены хранить в течение длительного времени или навсегда. Это позволяет упростить политику очистки (см. Ниже), а также оптимизировать то, как вы храните компоненты на диске, которые облегчают резервное копирование постоянных вещей, меньше фрагментации уровня блока и других проблем, связанных с вводом-выводом.

### Компонентный этап

Другим распространенным вариантом использования внутренних компонентов является управление ими через жизненный цикл промежуточной и рекламной кампании.

Когда компонент переносится в репозиторий, этот репозиторий не может быть конечным пунктом назначения. Представьте рабочий процесс, в котором компонент-кандидат на выпуск должен пройти тестирование интеграции и процессы QA. Только компоненты, проходящие через этот процесс, должны быть доступны для других команд или клиентов. 
Менеджер репозитория может включить этот рабочий процесс, предоставив механизмы для связывания компонентов и продвижения их на разных этапах, где каждый этап может привести к тому, что они будут доступны для разных пользователей по разным известным URL-адресам.

Этот тип функций часто выполняется в сочетании с автоматизированным конвейером CI / CD, который более подробно обсуждается позже.

РАЗДЕЛ 5

## Фактор 3: безопасность и обслуживание

### Аутентификация и авторизация

Поскольку диспетчер хранилища хранит связанные с проектом двоичные файлы, для защиты полученных двоичных файлов должны использоваться те же права, которые применяются для самих проектов (например, разрешения доступа к исходному коду). В некоторых случаях доступ к двоичным файлам может предоставляться без предоставления доступа к источнику - и это может управляться на уровне репозитория. 
Чтобы упростить и централизовать управление пользователями, настройте диспетчер репозитория для интеграции с другими организационными системами, такими как LDAP, Active Directory или одноранговые серверы (SSO). 
Как и для отслеживания источников, двоичная прослеживаемость одинаково важна. Отслеживайте изменения в репозитории (например, какой пользователь загрузил компонент и когда или кто загружает компоненты) для целей аудита.

### Политики очистки

Хотя большинство компонентов обычно хранятся в течение длительного времени (как и любой другой продукт или дистрибутив), есть некоторые случаи, когда мы можем извлечь выгоду из очистки содержимого репозитория. 
Хранилища мгновенного снимка должны время от времени очищаться, чтобы обеспечить разумное использование диска, особенно при использовании непрерывной интеграции, поскольку CI может легко создавать десятки новых сборок в день. Как правило, снимки можно очистить при выпуске новой версии, но это можно изменить, чтобы сохранить последние снимки. 
Проксированные репозитории для сторонних компонентов также можно очистить, когда компоненты не используются какой-либо версией, например, для компонентов, используемых во время доказательства концепции, которая отбрасывается. В этих случаях, Это хорошая практика отделить компоненты, используемые в производстве от компонентов, используемых во время разработки, для испытаний или доказательства концепции (это также можно сделать во время продвижения по службе: продвигать не только встроенные компоненты, но и зависимости). Это значительно упростит управление вниз по течению.

### Поддержка распределенных команд

Когда команды, которые обращаются к репозиториям, расположены в разных местах или распределены по всему миру, также важно обеспечить доступ ко всем компонентам, как внутренним, так и сторонним. Напомним, что основная суть диспетчера репозитория - это кеширующий прокси-сервер, поэтому, чтобы воспользоваться преимуществами, вы действительно хотите, чтобы он располагался в каждом физическом месте, где у вас есть несколько разработчиков. В противном случае разработчики могут пострадать от медленных и ненадежных сроков сборки, потому что они извлекают компоненты из Интернета и / или через WAN.

В некоторых случаях вам захочется предварительно воспроизвести какой-либо контент в другом месте, чтобы заполнить репо для разработчиков или достичь некоторого уровня HA или DR. Некоторые менеджеры репозитория будут вынуждать сложность репликации для администраторов, требуя, чтобы вы настраивали зеркальное отображение «точка-точка», часто для каждого репозитория индивидуально. Другие решения разделяют представление о том, какие компоненты должны быть раскрыты в каких логических хранилищах из понятия о том, где и как они расположены географически, чтобы инструмент мог выполнять работу разумно и динамично.

### Высокая доступность

Использование Менеджера репозитория для хранения всех зависимостей разработки также означает, что ваш репозиторий является центральной частью вашей инфраструктуры; Любое время простоя означает прекращение развития со всеми вытекающими последствиями. В среде CI / CD, когда диспетчер репозитория недоступен, сборка не может выполнить или развернуть в производство, что может быть катастрофическим для бизнеса или организации. 
На сегодняшний день продвинутые менеджеры репозитория используют частное двоичное облачное хранилище и бэкэнд для всех компонентов. Эта структура компонента намеренно отделяет топологию физического узла от топологии логических компонентов.

### Аварийное восстановление

Компонентная ткань также является важной частью процесса аварийного восстановления. В случае потери сетевого подключения к центру обработки данных, компонентная структура хранит все данные в отдельных узлах в других центрах обработки данных, поэтому запросы диспетчера репозитория могут быть направлены другим менеджерам репозитория. Когда проблема сети устранена и центр данных возвращается в оперативный режим, любые новые компоненты и данные в ткани автоматически синхронизируются с центром данных, который теперь доступен снова.

РАЗДЕЛ 6

## Фактор 4: Менеджеры хранилищ в Toolchain DevOps

Менеджеры хранилищ стали неотъемлемой частью конвейера DevOps и включены почти в каждую ссылочную архитектуру, найденную в организациях по всему миру.

Любой компонент или артефакт сборки, который создается или нужен в процессе CI / CD, хранится в диспетчере репозитория. Хранилища интегрированы в Jenkins, Maven, Gradle, Puppet, Chef и почти каждый другой инструмент в toolchain DevOps. Например, Rundeck организует развертывание приложений для производства и использует диспетчер репозитория для получения компонентов, необходимых для развертывания. Менеджеры хранилищ являются центральными и важными для внедрения современных сред DevOps.

![Название изображения](https://dzone.com/storage/temp/4902422-picture2.png)

РАЗДЕЛ 7

## Трубопроводы CI / CD

### Что такое непрерывная интеграция?

С появлением бережливого, гибкого, а в последнее время, Continuous Delivery и DevOps, проекты больше не инкубируются в течение нескольких месяцев в процессе развития, подобном водопаду. Вместо этого они подвергаются постоянным изменениям и выпускам. Во многих случаях эти проекты распространяются по всей организации на разных этапах жизненного цикла разработки.

Это постоянное развитие означает, что только объем изменений требует автоматизированного подхода к созданию приложений. Чтобы поддерживать разработчиков в масштабе, было разработано несколько инструментов для автоматизации большей части того, что происходит в создании и выпуске приложений. Это включает в себя возможность упаковывать приложения или компоненты, созданные во время сборки, и делать это непрерывно с внесением изменений. Вкратце это называется непрерывной интеграцией или CI.

### Трубопровод

На основе преимуществ автоматизации от серверов CI команды теперь могут полностью настраивать, что происходит где, когда и как. Другими словами, команды добавляют в различные контрольные точки на протяжении всего процесса, чтобы гарантировать, что приложения не имеют серьезных дефектов. Это не просто гарантия качества, а скорее управление, чтобы избежать включения уязвимостей, лицензий и архитектурных проблем в приложения и компоненты, которые создает команда. Результатом является подход, подобный конвейеру.

### **Менеджеры хранилищ и инструменты CI**

Менеджеры хранилища предоставляют несколько точек взаимодействия с инструментами CI, такими как Jenkins и Bamboo. Это может варьироваться от простого запроса и хранения прокси-компонентов компонентов в рамках процесса сборки, публикации встроенных компонентов для распространения среди организации разработки.

### **Строительные проекты**

Когда приложение создается с использованием Maven (или аналогичных инструментов сборки), он собирает компоненты из указанного местоположения (настроенного с помощью настроек Maven) и компилирует их. Конечным результатом может быть приложение или даже другой двоичный файл или компонент. Jenkins обеспечивает автоматизацию для этого, разрешая включение шага сборки Maven для проектов фристайла и мультиконфигурации. Когда вызывается этап построения, проект Maven будет создан, и если Maven настроен для этого, он может запросить компоненты из диспетчера репозитория. Аналогичным образом, используя цель развертывания Maven (у Maven есть такие цели, как чистая, компиляция, тестирование, упаковка, установка, развертывание всех из которых управляются плагинами), компоненты могут быть опубликованы как шаг сборки в нужное место.

![Название изображения](https://dzone.com/storage/temp/4902430-picture3.png)

### **Издательские проекты**

Для команд, продвигающихся в более продвинутые, непрерывные поставки и модели DevOps (Pipeline), Jenkins обеспечивает поддержку проектов в стиле трубопроводов. Это меньше связано с просто созданием или компиляцией проектов (à la Maven или аналогичным инструментом) и больше об автоматизации инструментов для принятия необходимых действий и / или получения того, где они должны быть на протяжении всего жизненного цикла разработки.

Например, это может быть создание пакета Maven и обеспечение его публикации в репозитории для тестирования, а затем удаление после завершения тестирования. В более сложных средах, вероятно, это означает, что несколько сборок происходят одновременно и параллельно, а затем собирают каждую сборку в единый пакет, который передается на стадию и в конечном итоге в производство. В некоторых случаях продукт этих сборок перемещается вперед. В других случаях, когда он больше не нужен, он автоматически удаляется.

Воздействие здесь заключается в том, что он отделяет процесс публикации от инструмента компиляции, позволяя большую настройку и компоненты передаваться в диспетчер репозитория в любой момент жизненного цикла разработки независимо от экосистемы разработки.

![Название изображения](https://dzone.com/storage/temp/4902431-picture4.png)

### Контейнерные соображения

Контейнеры докеров и их использование революционизировали то, как приложения и базовая операционная система упаковываются и развертываются в системах разработки, тестирования и производства. Docker Hub является публичным реестром для изображений контейнеров Docker, и к нему присоединяются все больше и больше общедоступных реестров, таких как реестр Google Container.

Во многих отношениях контейнер похож на другие компоненты с несколькими ключевыми отличиями:

- Они могут быть огромными. Компонент Java может составлять несколько сотен килобайт, но изображение контейнера может быть большим количеством гигабайт или больше. Это может вызвать нагрузку на базовую инфраструктуру диска, если размер и объем не ожидаются.
- Они состоят из множества слоев. Каждый слой фактически представляет собой дельта изменений файловой системы на нижележащих слоях. Это делает его интересным, потому что все, кроме уровня самого низкого уровня, не могут стоять в одиночестве.

Менеджеры хранилищ также предлагают поддержку контейнеров Docker. Диспетчер репозиториев действует как частный реестр Docker, который способен размещать собственные контейнеры, а также проксировать публичные реестры, когда необходимо загрузить непатентованные контейнеры. Вы можете открыть эти репозитории Docker непосредственно на клиентских инструментах или в качестве группы репозиториев, которая представляет собой хранилище, которое объединяет и предоставляет содержимое нескольких репозиториев в одном удобном URL-адресе.

Это позволяет сократить время и использование полосы пропускания для доступа к изображениям Docker в частном реестре, а также обмениваться собственными изображениями внутри вашей организации в размещенном репозитории. Затем пользователи могут запускать контейнеры на основе этих изображений, что приводит к полностью закрытому реестру Docker со всеми функциями, доступными в диспетчере репозитория.

Подумайте о том, что диспетчер хранилищ является гетерогенным местом хранения и управления изображениями Docker, программными компонентами с открытым исходным кодом и другими артефактами сборки. Для сравнения, другие частные решения для реестров контейнеров действуют как однородные репозитории.

![Название изображения](https://dzone.com/storage/temp/4902432-picture5.png)